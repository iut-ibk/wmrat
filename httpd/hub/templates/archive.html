{% extends "base.html" %}

{% block content %}

<!-- NOTE: this should go in <head> ... -->
<meta http-equiv="refresh" content="5">

<!-- main content -->
<main class="container">
    <div class="content">

        <!-- scenario archive list -->
        {% if page_obj %}

            <table class="table table-striped" style="margin-top: 32px;">
                <thead>
                    <tr>
                        <th scope="col">ID</th>
                        <th scope="col">Name</th>
                        <th scope="col">Date</th>
                        <th scope="col">Status</th>
                        <th scope="col">Info</th>
                        <th scope="col"></th>
                        <th scope="col"></th>
                        <th scope="col"></th>
                        <th scope="col"></th>
                    </tr>
                </thead>
                <tbody>
                    {% for scenario in page_obj %}
                    <tr>
                        <!-- scenario meta information -->
                        <td class="align-middle">{{ scenario.id }}</td>
                        <td class="align-middle">{{ scenario.name }}</td>
                        <td class="align-middle">{{ scenario.submitted|date:"Y.m.d" }}</td>

                        <!-- status -->
                        {% if scenario.proc_status == 0 %}
                        <td class="align-middle">
                            <button class="btn btn-success btn-sm" type="button" disabled>{{ scenario.get_scenario_status_str }}</button>
                        </td>
                        {% elif scenario.proc_status == 1 %}
                        <td class="align-middle">
                            <button class="btn btn-danger btn-sm" type="button" disabled>{{ scenario.get_scenario_status_str }}</button>
                        </td>
                        {% elif scenario.proc_status == 2 %}
                        <td class="align-middle">
                            <button class="btn btn-warning btn-sm" type="button" disabled>{{ scenario.get_scenario_status_str }}</button>
                        </td>
                        {% elif scenario.proc_status == 3 %}
                        <td class="align-middle">
                            <button class="btn btn-primary btn-sm" type="button" disabled><span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span> {{ scenario.get_scenario_status_str }}</button>
                        </td>
                        {% elif scenario.proc_status == 4 %}
                        <td class="align-middle">
                            <button class="btn btn-warning btn-sm" type="button" disabled>{{ scenario.get_scenario_status_str }}</button>
                        </td>
                        {% else %}
                        <td class="align-middle">
                            <button class="btn btn-warning btn-sm" type="button" disabled><span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span> {{ scenario.get_scenario_status_str }}</button>
                        </td>
                        {% endif %}

                        <!-- info -->
                        <td class="align-middle">{{ scenario.info_msg }}{% if scenario.proc_status == 0 or scenario.proc_status == 1 %} ({{ scenario.duration_s|floatformat:0 }}s) {% endif %}</td>

                        <!-- visualize -->
                        {% if scenario.proc_status == 0 or scenario.proc_status == 1 %}
                        <td class="align-middle"><a class="text-decoration-none" href="scenario/{{scenario.id}}/visualize"><i class="fas fa-eye"></i> show</a></td>
                        {% else %}
                        <td></td>
                        {% endif %}
                        
                        <!-- cancel -->
                        {% if scenario.proc_status == 2 or scenario.proc_status == 3 %}
                        <td class="align-middle">
                            {% if user.id == scenario.user.id or user.is_superuser %}
                            <form method="post" action=" {% url 'cancel' scenario_id=scenario.id %}">
                                {% csrf_token %}
                                {% if scenario.proc_status == 2 %}
                                <button type="submit" class="btn btn-danger btn-sm"><i class="fas fa-stop"></i> cancel</button>
                                {% else %}
                                <button type="submit" class="btn btn-danger btn-sm"><i class="fas fa-stop"></i> stop</button>
                                {% endif %}
                            </form>
                            {% endif %}
                        </td>
                        {% else %}
                        <td></td>
                        {% endif %}

                        <!-- download -->
                        {% if scenario.proc_status == 0 or scenario.proc_status == 1 %}
                        <td class="align-middle"><a class="text-decoration-none" href="scenario/{{scenario.id}}/download"><i class="fas fa-download"></i> download</a></td>
                        {% else %}
                        <td></td>
                        {% endif %}

                        <!-- delete -->
                        {% if scenario.proc_status == 0 or scenario.proc_status == 1 or scenario.proc_status == 4 %}
                        <td class="align-middle">
                            {% if user.id == scenario.user.id or user.is_superuser %}
                            <form method="post" action=" {% url 'delete' scenario_id=scenario.id %}">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-warning btn-sm"><i class="fas fa-trash-can"></i> delete</button>
                            </form>
                            {% endif %}
                        </td>
                        {% else %}
                        <td></td>
                        {% endif %}

                    </tr>
                    {% endfor %}
                </tbody>
            </table>

            <div class="row">

               <nav aria-label="Page navigation example">
                   <ul class="pagination pagination-sm justify-content-center">
                       {% if page_obj.has_previous %}
                       <li class="page-item"><a class="page-link" href="?p=1&{{query_str}}">1</a></li>
                       <li class="page-item">
                           <a class="page-link" href="?p={{page_obj.previous_page_number}}&{{query_str}}" aria-label="Previous"><span aria-hidden="true">&laquo; Previous</span></a>
                       </li>
                       {% endif %}

                       <li class="page-item"><a class="page-link" href="?p={{ page_obj.number }}&{{query_str}}">{{ page_obj.number }}</a></li>

                       {% if page_obj.has_next %}
                       <li class="page-item">
                       <a class="page-link" href="?p={{page_obj.next_page_number}}&{{query_str}}" aria-label="Next"><span aria-hidden="true">Next &raquo;</span></a>
                       </li>
                       <li class="page-item"><a class="page-link" href="?p={{ page_obj.paginator.num_pages }}&{{query_str}}">{{ page_obj.paginator.num_pages }}</a></li>
                       {% endif %}
                   </ul>
               </nav>

                <p style="text-align: center; font-size: 14px">{{page_obj.paginator.count}} scenario{% if page_obj.paginator.count > 1 %}s{% endif %}</p>

                <div class="col-sm-4">
                </div>

            </div>

        {% else %}
            <p style="margin-top: 32px; text-align: center;">No scenarios. ☹️</p>
        {% endif %}

    </div>
</main>

{% endblock %}
