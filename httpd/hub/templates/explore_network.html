{% extends "base.html" %}

{% block content %}

<!-- main content -->
<main class="container">
    <div class="content">

        <div class="row" style="margin-top: 32px;">

            <!-- args -->
            <div class="col-sm-12">

                <form class="row g-3" action="{% url 'new' %}" method="post" id="main_form">

                    {% csrf_token %}

                    <div class="col-md-3">
                        <label for="scenario_name" class="form-label">Network name</label>
                        <input type="text" class="form-control" id="scenario_name" name="scenario_name" value="Blabla" disabled>
                    </div>

                    <!-- todo: auto fill from defaults? -->
                    <div class="col-md-3">
                        <label for="scenario_name" class="form-label">Begin analysis</label>
                        <input type="text" class="form-control" id="scenario_name" name="scenario_name" value="2023.01.01" disabled>
                    </div>

                    <!-- todo: auto fill from defaults? -->
                    <div class="col-md-3">
                        <label for="scenario_name" class="form-label">End analysis</label>
                        <input type="text" class="form-control" id="scenario_name" name="scenario_name" value="2023.01.15" disabled>
                    </div>

                    <div class="col-md-3">
                        <label for="scenario_name" class="form-label">End analysis</label>
                        <input type="text" class="form-control btn btn-success" id="thebutton" name="scenario_name" value="Customize" disabled>
                    </div>

                    <hr />

                <!-- XXX: no form -->
                </form>

            </div>

        </div>

        <div class="row" style="margin-top: 32px;">
            <!-- map -->
            <div class="col-sm-6">
                <!-- XXX: hacky hardocded -->
                <div id="map_id" style="height: 950px; border-radius: 8px;"></div>

            </div>

            <div class="col-sm-6">
                <div class="row">
                    <div id="graph1">
                </div>
                <div class="row">
                    <div id="graph2">
                    </div>
                </div>
                <div class="row">
                    <div id="graph3">
                    </div>
                </div>
            </div>

        </div>

        <div class="row" style="margin-top: 32px;">
            <!-- map -->
        </div>

        <div class="row" style="margin-top: 10px;">
            <div id="alert-ui" class="alert alert-primary" role="alert">
                You have to provide an EPANET input file.
            </div>
        </div>

        <hr />

        <div class="row">
            ... slider thingy 
        </div>

    </div>
</main>

<script>
    function setAlert(text) {
        var t = document.getElementById('alert-ui');
        t.style.display = '';
        t.innerHTML = text;
    }

    function checkInput() {
        //TODO: failures, etc.

        /* everything (at least client-side) okay at that point ... */

        var t = document.getElementById('alert-ui');
        t.style.display = 'none';

        var t = document.getElementById('thebutton');
        t.disabled = false;
    }

    checkInput();

    var defaultLatLng = new L.LatLng(47.263, 11.404)

    var url = 'https://{s}.wien.gv.at/basemap/bmaporthofoto30cm/normal/google3857/{z}/{y}/{x}.jpeg',
        attrib = 'Datenquelle: <a href="https://basemap.at">basemap.at</a>',
        tilelayer = L.tileLayer(url, { maxZoom: 20, attribution: attrib, subdomains: ['maps1', 'maps2', 'maps3', 'maps4']}),
        map = new L.Map('map_id', { center: defaultLatLng, zoom: 14 });

    drawnItems = L.featureGroup().addTo(map);

    tilelayer.addTo(map);

    //let color_ramp_dict = {{ color_ramp|safe }};

    var graph = {{ graph|safe }};

    let pipes = L.geoJson(graph, {
        /*
        style: function(feature) {
            d = feature.properties.d;
            return {color: color_ramp_dict[d] || '#000000'}
        }
        */
    });

    drawnItems.addLayer(pipes);

    map.fitBounds(drawnItems.getBounds());

    map.setZoom(15);

    g = new Dygraph(
        document.getElementById("graph1"),
        // For possible data formats, see http://dygraphs.com/data.html
        // The x-values could also be dates, e.g. "2012/03/15"
        `X,Y,Z
        1,0,3
        2,2,6
        3,4,8
        4,6,9
        5,8,9
        6,10,8
        7,12,6
        8,14,3`,
        {
          // options go here. See http://dygraphs.com/options.html
          legend: 'always',
          animatedZooms: true,
          title: 'dygraphs chart template'
        });

        g = new Dygraph(
            document.getElementById("graph2"),
            // For possible data formats, see http://dygraphs.com/data.html
            // The x-values could also be dates, e.g. "2012/03/15"
            `X,Y,Z
            1,0,3
            2,2,6
            3,4,8
            4,6,9
            5,8,9
            6,10,8
            7,12,6
            8,14,3`,
            {
              // options go here. See http://dygraphs.com/options.html
              legend: 'always',
              animatedZooms: true,
              title: 'dygraphs chart template'
            });
    
        g = new Dygraph(
            document.getElementById("graph3"),
            // For possible data formats, see http://dygraphs.com/data.html
            // The x-values could also be dates, e.g. "2012/03/15"
            `X,Y,Z
            1,0,3
            2,2,6
            3,4,8
            4,6,9
            5,8,9
            6,10,8
            7,12,6
            8,14,3`,
            {
              // options go here. See http://dygraphs.com/options.html
              legend: 'always',
              animatedZooms: true,
              title: 'dygraphs chart template'
            });



</script>

{% endblock %}
