{% extends "base.html" %}

{% block content %}

<!-- main content -->
<main class="container">
    <div class="content">

        <div class="row" style="margin-top: 32px;">
            <!-- map -->
            <div class="col-sm-12">
                <!-- XXX: hacky hardocded -->
                <div id="map_id" style="height: 950px; width=100%; border-radius: 8px;"></div>

            </div>

        </div>

        <div class="row" style="margin-top: 32px;">
            <!-- map -->
        </div>

    </div>

<style>
.legend { text-align: left; line-height: 18px; color: #555; } .legend i { width: 18px; height: 18px; float: left; margin-right: 8px; opacity: 0.7; }</style>
</style>
</main>

<script>
    var defaultLatLng = new L.LatLng(47.263, 11.404)

    var url = 'https://{s}.wien.gv.at/basemap/bmaporthofoto30cm/normal/google3857/{z}/{y}/{x}.jpeg',
        attrib = 'Datenquelle: <a href="https://basemap.at">basemap.at</a>',
        tilelayer = L.tileLayer(url, { maxZoom: 22, attribution: attrib, subdomains: ['maps1', 'maps2', 'maps3', 'maps4']}),
        map = new L.Map('map_id', { center: defaultLatLng, zoom: 14 });

    drawnItems = L.featureGroup().addTo(map);

    tilelayer.addTo(map);

    let color_ramp = {{ color_ramp|safe }};
    console.log(color_ramp);

    function getColor(d) {
        for (let i=color_ramp.length-1; i>=0; i--) {
            if (d >= color_ramp[i][0]) {
                return color_ramp[i][1];
            }
        }

        return color_ramp[0][1];
        /*
        return d > 1000 ? '#800026' :
               d > 500  ? '#BD0026' :
               d > 200  ? '#E31A1C' :
               d > 100  ? '#FC4E2A' :
               d > 50   ? '#FD8D3C' :
               d > 20   ? '#FEB24C' :
               d > 10   ? '#FED976' :
                          '#FFEDA0';
        */
    }

    var graph = {{ graph|safe }};

    let links = L.geoJson(graph, {
        style: function(feature) {
            //return {color: color_ramp_dict[d] || '#000000'}
            return {color: getColor(feature.properties.nodes_affected)}
        }
    });

    /*
    var legend = L.control({position: 'bottomright'});

    legend.onAdd = function (map) {
    
        var div = L.DomUtil.create('div', 'info legend'),
            grades = [0, 10, 20, 50, 100, 200, 500, 1000],
            labels = [];
    
        // loop through our density intervals and generate a label with a colored square for each interval
        for (var i = 0; i < grades.length; i++) {
            div.innerHTML +=
                '<i style="background:' + getColor(grades[i] + 1) + '"></i> ' +
                grades[i] + (grades[i + 1] ? '&ndash;' + grades[i + 1] + '<br>' : '+');
        }
    
        return div;
    };
    
    legend.addTo(map);
    */

    drawnItems.addLayer(links);

    map.fitBounds(drawnItems.getBounds());

</script>

{% endblock %}
